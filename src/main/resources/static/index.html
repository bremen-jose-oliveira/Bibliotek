<!-- index.html-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Book</title>
    <link href="/dist/styles.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800">
<div class="container mx-auto py-8">
    <h1 class="text-3xl font-bold mb-6">Add New Book</h1>
    <form id="add-book-form" class="bg-white p-6 rounded-lg shadow-md">
        <div class="mb-4">
            <label for="search-query" class="block text-gray-700">Search Book</label>
            <input type="text" id="search-query" class="mt-1 block w-full border-gray-300 rounded-md" placeholder="Enter book title or author">
        </div>
        <div id="search-results" class="mb-4 bg-gray-200 p-2 rounded-md hidden"></div> <!-- Results Container -->

        <div class="mb-4">
            <label for="title" class="block text-gray-700">Title</label>
            <input type="text" id="title" class="mt-1 block w-full border-gray-300 rounded-md" required>
        </div>
        <div class="mb-4">
            <label for="author" class="block text-gray-700">Author</label>
            <input type="text" id="author" class="mt-1 block w-full border-gray-300 rounded-md" required>
        </div>
        <div class="mb-4">
            <label for="year" class="block text-gray-700">Year</label>
            <input type="number" id="year" class="mt-1 block w-full border-gray-300 rounded-md" required>
        </div>
        <div class="mb-4">
            <label for="publisher" class="block text-gray-700">Publisher</label>
            <input type="text" id="publisher" class="mt-1 block w-full border-gray-300 rounded-md" required>
        </div>
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Add Book</button>
    </form>
    <div id="books-list" class="container mx-auto py-8"></div>

</div>

<script src="/dist/bundle.js"></script>

<script>
    const searchQueryInput = document.getElementById('search-query');
    const searchResultsContainer = document.getElementById('search-results');

    // Fetch book data from Google Books API
    async function fetchBookData() {
        const query = searchQueryInput.value.trim();
        if (!query) {
            searchResultsContainer.innerHTML = '';
            searchResultsContainer.classList.add('hidden');
            return;
        }

        const googleBooksApiUrl = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}`;

        try {
            const response = await fetch(googleBooksApiUrl);
            if (!response.ok) {
                throw new Error(`An error occurred: ${response.statusText}`);
            }
            const data = await response.json();

            // Display search results
            displaySearchResults(data.items || []);
        } catch (error) {
            console.error('Failed to fetch book data:', error);
            alert('Failed to fetch book data. Please try again.');
        }
    }

    // Display search results
    function displaySearchResults(books) {
        searchResultsContainer.innerHTML = ''; // Clear existing results
        if (books.length > 0) {
            searchResultsContainer.classList.remove('hidden'); // Show the results container

            books.forEach(book => {
                const bookData = book.volumeInfo;
                const bookItem = document.createElement('div');
                bookItem.className = 'p-2 hover:bg-gray-300 cursor-pointer flex items-center';

                // Create a book item with cover image and title
                bookItem.innerHTML = `
                    ${bookData.imageLinks ? `<img src="${bookData.imageLinks.thumbnail}" alt="${bookData.title}" class="w-16 h-24 mr-4">` : ''}
                    <div>
                        <div class="font-semibold">${bookData.title}</div>
                        <div class="text-gray-600">${bookData.authors ? bookData.authors.join(', ') : 'Unknown Author'}</div>
                    </div>
                `;

                // Click event to populate the form with selected book data
                bookItem.addEventListener('click', () => populateForm(bookData));

                searchResultsContainer.appendChild(bookItem);
            });
        } else {
            searchResultsContainer.classList.add('hidden'); // Hide if no results
        }
    }

    // Populate the form with selected book data
    function populateForm(bookData) {
        document.getElementById('title').value = bookData.title || '';
        document.getElementById('author').value = bookData.authors ? bookData.authors.join(', ') : '';
        document.getElementById('year').value = bookData.publishedDate ? bookData.publishedDate.substring(0, 4) : '';
        document.getElementById('publisher').value = bookData.publisher || '';
        searchResultsContainer.innerHTML = ''; // Clear results after selection
        searchResultsContainer.classList.add('hidden'); // Hide results container
    }

    // Listen for input changes to fetch book data
    searchQueryInput.addEventListener('input', fetchBookData);

    // Handle form submission
    document.getElementById('add-book-form').addEventListener('submit', async function (event) {
        event.preventDefault();
        const bookData = {
            title: document.getElementById('title').value,
            author: document.getElementById('author').value,
            year: document.getElementById('year').value,
            publisher: document.getElementById('publisher').value,
        };

        try {
            const response = await fetch('http://localhost:8080/api/books', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(bookData),
            });

            if (response.ok) {
                alert('Book added successfully!');
                // Optionally reset the form or redirect
            } else {
                throw new Error(`Failed to add book: ${response.statusText}`);
            }
        } catch (error) {
            console.error('Error adding book:', error);
            alert('Failed to add book. Please try again.');
        }
    });
</script>
</body>
</html>
