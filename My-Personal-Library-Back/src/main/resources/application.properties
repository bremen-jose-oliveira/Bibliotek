# =============================================================================
# All secrets MUST be provided via environment variables (e.g. Fly.io secrets,
# .env not in Git, or CI). Do not commit passwords or API keys here.
# =============================================================================
# Required env vars: DB_URL or (DB_HOST, DB_NAME, DB_USER, DB_PW),
#   FRONT_END_URL, BACK_END_URL, JWT_SECRET_KEY, SMTP_EMAIL, SMTP_PASSWORD,
#   GOOGLE_CLIENT_SECRET, APPLE_SECRET (and optionally APPLE_KEY_PATH / key file)
# =============================================================================

# Database (use placeholders; set DB_URL or individual vars in env)
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/neondb}
spring.datasource.username=${DB_USER:}
spring.datasource.password=${DB_PW:}
spring.jpa.hibernate.ddl-auto=update

spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.datasource.driver-class-name=org.postgresql.Driver

server.address=0.0.0.0
server.port=8080
# Behind Fly.io/proxy: use X-Forwarded-Proto so redirects and links use https:// (avoids mixed-content / insecure favicon)
server.forward-headers-strategy=framework

# Mail (Brevo/SMTP) - set SMTP_PASSWORD and SMTP_EMAIL in env
spring.mail.host=smtp-relay.brevo.com
spring.mail.port=587
spring.mail.username=${SMTP_USERNAME:}
spring.mail.password=${SMTP_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.ssl.enable=false

# App URLs and JWT - set in env (e.g. Fly.io config)
FrontEnd.url=${FRONT_END_URL}
backEnd.url=${BACK_END_URL}
# JWT: secret from env; expiry in hours (default 7 days). No refresh â€“ user re-logs in after expiry.
Jwt.key=${JWT_SECRET_KEY}
Jwt.expiration-hours=${JWT_EXPIRATION_HOURS:168}
Smtp.email=${SMTP_EMAIL}

spring.jpa.show-sql=true
spring.main.banner-mode=off
logging.level.root=warn
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.oauth2=TRACE
logging.level.org.springframework.web=DEBUG
logging.level.org.hibernate=DEBUG
logging.level.org.springframework=DEBUG

spring.resources.static-locations=classpath:/static/
spring.datasource.hikari.maximum-pool-size=20

# Google OAuth - client-secret MUST come from env
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:}
spring.security.oauth2.client.registration.google.redirect-uri=${BACK_END_URL}/login/oauth2/code/google
spring.security.oauth2.client.registration.google.scope=email,profile

## Apple OAuth2 - client-secret and key from env
spring.security.oauth2.client.registration.apple.team-id=${APPLE_TEAM_ID:}
spring.security.oauth2.client.registration.apple.key-id=${APPLE_KEY_ID:}
spring.security.oauth2.client.registration.apple.client-id=com.jose-oliv.mypersonallibraryfront.si
spring.security.oauth2.client.registration.apple.redirect-uri=${BACK_END_URL}/login/oauth2/code/apple
spring.security.oauth2.client.registration.apple.scope=openid,email,name
spring.security.oauth2.client.registration.apple.client-authentication-method=client_secret_post
spring.security.oauth2.client.registration.apple.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.apple.client-name=Apple
spring.security.oauth2.client.registration.apple.user-name-attribute=sub
spring.security.oauth2.client.registration.apple.client-secret=${APPLE_SECRET}
spring.security.oauth2.client.provider.apple.authorization-uri=https://appleid.apple.com/auth/authorize?response_mode=form_post
spring.security.oauth2.client.provider.apple.token-uri=https://appleid.apple.com/auth/token
spring.security.oauth2.client.provider.apple.jwk-set-uri=https://appleid.apple.com/auth/keys
spring.security.oauth2.client.provider.apple.user-name-attribute=sub

